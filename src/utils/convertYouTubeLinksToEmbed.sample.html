<!-- ========================================
     YouTube Links to Gutenberg Embed Converter
     Test Cases (v2.0 - Idempotent + Dedupe)
     ======================================== -->

<!-- Test Case 1: URL แยกบรรทัด + caption เป็น italic (รูปแบบทั่วไป) -->
<p>https://youtu.be/8n71hbivVNk?feature=shared</p>
<p><em>การทำงานของเครื่อง Fotona Laser</em></p>

<!-- Expected Output:
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
https://youtu.be/8n71hbivVNk?feature=shared
</div><figcaption class="wp-element-caption">การทำงานของเครื่อง Fotona Laser</figcaption></figure>
-->

<!-- ======================================== -->

<!-- Test Case 2: Classic block - URL + BR + caption italic ในบรรทัดเดียว -->
<p>https://youtu.be/ABC123<br><em>Caption ในบรรทัดเดียวกัน</em></p>

<!-- Expected Output:
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/ABC123</div>
  <figcaption class="wp-element-caption"><em>Caption ในบรรทัดเดียวกัน</em></figcaption>
</figure>
-->

<!-- ======================================== -->

<!-- Test Case 3: URL เดี่ยวไม่มี caption -->
<p>https://www.youtube.com/watch?v=dQw4w9WgXcQ</p>

<!-- Expected Output:
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://www.youtube.com/watch?v=dQw4w9WgXcQ</div>
</figure>
-->

<!-- ======================================== -->

<!-- Test Case 4: URL เป็น anchor tag + caption -->
<p><a href="https://youtu.be/XYZ789">https://youtu.be/XYZ789</a></p>
<p><i>Caption เป็น italic tag</i></p>

<!-- Expected Output:
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/XYZ789</div>
  <figcaption class="wp-element-caption"><em>Caption เป็น italic tag</em></figcaption>
</figure>
-->

<!-- ======================================== -->

<!-- Test Case 5: URL อยู่กลางย่อหน้า - ไม่ควรแปลง -->
<p>ดูวิดีโอได้ที่ https://youtu.be/ABC123 และกดไลค์ด้วยนะครับ</p>

<!-- Expected Output:
<p>ดูวิดีโอได้ที่ https://youtu.be/ABC123 และกดไลค์ด้วยนะครับ</p>
(ไม่แปลง - คง <p> ไว้)
-->

<!-- ======================================== -->

<!-- Test Case 6: Caption เป็นข้อความธรรมดาสั้น ๆ -->
<p>https://youtu.be/TEST456</p>
<p>วิธีใช้งานเบื้องต้น</p>

<!-- Expected Output:
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/TEST456</div>
  <figcaption class="wp-element-caption"><em>วิธีใช้งานเบื้องต้น</em></figcaption>
</figure>
-->

<!-- ======================================== -->

<!-- Test Case 7: YouTube URL รูปแบบ youtube.com/watch?v= พร้อม parameters -->
<p>https://www.youtube.com/watch?v=xyz123&t=10s</p>
<p><em>ตัวอย่างการใช้งาน</em></p>

<!-- Expected Output:
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://www.youtube.com/watch?v=xyz123&t=10s</div>
  <figcaption class="wp-element-caption"><em>ตัวอย่างการใช้งาน</em></figcaption>
</figure>
-->

<!-- ======================================== -->

<!-- Test Case 8: Paragraph ธรรมดา (ไม่มี YouTube URL) - ไม่ควรกระทบ -->
<p>This is a regular paragraph with no YouTube link.</p>

<!-- Expected Output:
<p>This is a regular paragraph with no YouTube link.</p>
(ไม่เปลี่ยนแปลง)
-->

<!-- ========================================
     v2.0 NEW TEST CASES
     ======================================== -->

<!-- Test Case 9: ★ IDEMPOTENT - URL ที่อยู่ใน figure แล้ว (ไม่ควรแปลงซ้ำ) -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio">
  <div class="wp-block-embed__wrapper">https://youtu.be/ALREADY_EMBEDDED</div>
  <figcaption class="wp-element-caption"><em>Caption อยู่แล้ว</em></figcaption>
</figure>

<!-- Expected Output:
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/ALREADY_EMBEDDED</div>
  <figcaption class="wp-element-caption"><em>Caption อยู่แล้ว</em></figcaption>
</figure>
(เหมือนเดิม - ไม่แปลงซ้ำ)
-->

<!-- ======================================== -->

<!-- Test Case 10: ★ DEDUPE - figure ซ้อนกัน (edge case - ต้องรวมเป็นชั้นเดียว) -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio">
  <figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio">
    <div class="wp-block-embed__wrapper">https://youtu.be/NESTED123</div>
  </figure>
</figure>

<!-- Expected Output (หลัง Dedupe Pass):
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/NESTED123</div>
</figure>
(รวมเป็น 1 figure เดียว)
-->

<!-- ======================================== -->

<!-- Test Case 11: ★ IDEMPOTENT - รัน 2 ครั้งต้องได้ผลเดิม -->
<p>https://youtu.be/IDEMPOTENT_TEST</p>
<p><em>Caption สำหรับทดสอบ Idempotent</em></p>

<!-- Expected Output (รันครั้งแรก):
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/IDEMPOTENT_TEST</div>
  <figcaption class="wp-element-caption"><em>Caption สำหรับทดสอบ Idempotent</em></figcaption>
</figure>

Expected Output (รันครั้งที่ 2):
[เหมือนเดิม 100%]
-->

<!-- ======================================== -->

<!-- Test Case 12: DEDUPE - wrapper ซ้ำภายใน figure เดียวกัน (edge case) -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio">
  <div class="wp-block-embed__wrapper">https://youtu.be/FIRST_WRAPPER</div>
  <div class="wp-block-embed__wrapper">https://youtu.be/SECOND_WRAPPER</div>
</figure>

<!-- Expected Output (หลัง Dedupe Pass):
<figure class="wp-block-embed ...">
  <div class="wp-block-embed__wrapper">https://youtu.be/FIRST_WRAPPER</div>
</figure>
(เก็บตัวแรก ลบตัวที่ 2)
-->

<!-- ========================================
     ACCEPTANCE CRITERIA SUMMARY
     ======================================== -->

<!-- ✅ Checklist:
[ ] URL แยกบรรทัด + caption → figure + figcaption
[ ] Classic block (URL + BR + caption) → figure + figcaption
[ ] URL เดี่ยว → figure (ไม่มี figcaption)
[ ] URL เป็น anchor → แปลงได้
[ ] URL กลางย่อหน้า → ไม่แปลง
[ ] Caption ธรรมดา → ตรวจจับได้
[ ] ★ Idempotent → รันซ้ำได้ผลเดิม
[ ] ★ Dedupe → รวม figure ซ้อนเป็นชั้นเดียว
[ ] ★ ป้องกันแปลงซ้ำ → ถ้าอยู่ใน figure แล้วไม่แปลง
[ ] Gutenberg → แสดงผลปกติ
-->

<!-- ========================================
     OUTPUT STRUCTURE (WordPress Gutenberg)
     ======================================== -->

<!-- STANDARD OUTPUT (with caption) - v3.0 with Gutenberg Comments:
<!-- wp:embed {"url":"https://youtu.be/VIDEO_ID","type":"video","providerNameSlug":"youtube","responsive":true} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio">
  <div class="wp-block-embed__wrapper">https://youtu.be/VIDEO_ID</div>
  <figcaption class="wp-element-caption"><em>Caption Text</em></figcaption>
</figure>
<!-- /wp:embed -->

NOTE: Caption มี <em> ครอบ (ตามมาตรฐาน Gutenberg)
NOTE: มี Gutenberg Comment Blocks (WordPress รู้จักเป็น YouTube block แท้ ๆ)
-->

<!-- STANDARD OUTPUT (without caption):
<!-- wp:embed {"url":"https://youtu.be/VIDEO_ID","type":"video","providerNameSlug":"youtube","responsive":true} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio">
  <div class="wp-block-embed__wrapper">https://youtu.be/VIDEO_ID</div>
</figure>
<!-- /wp:embed -->
-->
