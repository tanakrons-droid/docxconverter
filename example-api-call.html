<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Resolve URL API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-resolve {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-resolve:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .btn-clear {
            background: #f0f0f0;
            color: #666;
        }
        .btn-clear:hover {
            background: #e0e0e0;
        }
        .result-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        .result-box.show {
            display: block;
        }
        .result-box.success {
            background: #d4edda;
            border: 2px solid #28a745;
        }
        .result-box.error {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }
        .result-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .result-box.success .result-title {
            color: #155724;
        }
        .result-box.error .result-title {
            color: #721c24;
        }
        .result-content {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading.show {
            display: block;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .example-links {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .example-links h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .example-link {
            display: block;
            color: #667eea;
            text-decoration: none;
            padding: 5px 0;
            font-size: 12px;
            cursor: pointer;
        }
        .example-link:hover {
            text-decoration: underline;
        }
        .info-box {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }
        .info-box h3 {
            color: #0d47a1;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .info-box p {
            color: #1565c0;
            font-size: 13px;
            line-height: 1.6;
        }
        .info-box code {
            background: #bbdefb;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Facebook Reels URL Resolver</h1>
        <p class="subtitle">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Netlify Serverless Function API</p>

        <div class="example-links">
            <h3>üìù ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ:</h3>
            <a class="example-link" onclick="fillExample('https://www.facebook.com/share/r/ABC123/')">
                1. Short Link (/share/r/): https://www.facebook.com/share/r/ABC123/
            </a>
            <a class="example-link" onclick="fillExample('https://www.facebook.com/share/v/ABC123/')">
                2. Short Link (/share/v/): https://www.facebook.com/share/v/ABC123/
            </a>
            <a class="example-link" onclick="fillExample('https://m.facebook.com/reel/1234567890')">
                3. Mobile Link: https://m.facebook.com/reel/1234567890
            </a>
        </div>

        <div class="input-group">
            <label for="apiUrl">üåê API Endpoint URL:</label>
            <input
                type="text"
                id="apiUrl"
                placeholder="https://your-site.netlify.app/.netlify/functions/resolve-url"
                value="https://YOUR-SITE-NAME.netlify.app/.netlify/functions/resolve-url"
            >
            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç YOUR-SITE-NAME ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠ Netlify site ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            </small>
        </div>

        <div class="input-group">
            <label for="fbUrl">üé¨ Facebook Reel URL:</label>
            <input
                type="text"
                id="fbUrl"
                placeholder="https://www.facebook.com/share/r/ABC123/"
            >
        </div>

        <div class="button-group">
            <button class="btn-resolve" onclick="resolveUrl()">üöÄ Resolve URL</button>
            <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Clear</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
        </div>

        <div class="result-box" id="resultBox">
            <div class="result-title" id="resultTitle"></div>
            <div class="result-content" id="resultContent"></div>
        </div>

        <div class="info-box">
            <h3>üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h3>
            <p>
                1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç <code>API Endpoint URL</code> ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Netlify site ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>
                2. ‡∏ß‡∏≤‡∏á Facebook Reel URL (short link ‡∏´‡∏£‡∏∑‡∏≠ full link) ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á<br>
                3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Resolve URL" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô full reel URL<br>
                4. ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏° JSON response
            </p>
        </div>
    </div>

    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        function fillExample(url) {
            document.getElementById('fbUrl').value = url;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function clearAll() {
            document.getElementById('fbUrl').value = '';
            document.getElementById('resultBox').classList.remove('show', 'success', 'error');
            document.getElementById('resultBox').style.display = 'none';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
        async function resolveUrl() {
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const fbUrl = document.getElementById('fbUrl').value.trim();

            // Validate inputs
            if (!apiUrl) {
                showResult('error', '‚ùå Error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å API Endpoint URL');
                return;
            }

            if (!fbUrl) {
                showResult('error', '‚ùå Error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Facebook Reel URL');
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á loading
            document.getElementById('loading').classList.add('show');
            document.getElementById('resultBox').classList.remove('show');

            try {
                console.log('üîç [API Call] Starting...');
                console.log('  - API URL:', apiUrl);
                console.log('  - FB URL:', fbUrl);
                console.log('  - Timestamp:', new Date().toISOString());

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á full API URL ‡∏û‡∏£‡πâ‡∏≠‡∏° query parameter
                const fullApiUrl = `${apiUrl}?url=${encodeURIComponent(fbUrl)}`;
                console.log('  - Full API URL:', fullApiUrl);

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
                const response = await fetch(fullApiUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                console.log('üì• [API Response] Received');
                console.log('  - Status:', response.status);
                console.log('  - Status Text:', response.statusText);

                // ‡∏≠‡πà‡∏≤‡∏ô response body
                const data = await response.json();
                console.log('üì¶ [Response Data]:', data);

                // ‡∏ã‡πà‡∏≠‡∏ô loading
                document.getElementById('loading').classList.remove('show');

                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                if (response.ok && data.success) {
                    // Success
                    const resultText =
`‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!

Original URL:
${data.originalUrl}

Final Reel URL:
${data.finalUrl}

Method: ${data.method}
Timestamp: ${data.timestamp}

üìã Full Response:
${JSON.stringify(data, null, 2)}`;

                    showResult('success', '‚úÖ Resolve ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', resultText);
                    console.log('‚úÖ [Success] Resolution complete');
                } else {
                    // API returned but with error
                    const errorText =
`‚ö†Ô∏è API ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤

Status: ${response.status}
Message: ${data.message || 'No message'}

üìã Full Response:
${JSON.stringify(data, null, 2)}`;

                    showResult('error', '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Resolve ‡πÑ‡∏î‡πâ', errorText);
                    console.log('‚ö†Ô∏è [API Error]:', data);
                }

            } catch (error) {
                console.error('üí• [Fatal Error]:', error);

                // ‡∏ã‡πà‡∏≠‡∏ô loading
                document.getElementById('loading').classList.remove('show');

                // ‡πÅ‡∏™‡∏î‡∏á error
                let errorMessage = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î\n\n';

                if (error.message.includes('Failed to fetch')) {
                    errorMessage +=
`üîå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏î‡πâ

üí° ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:
1. URL ‡∏Ç‡∏≠‡∏á API ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠ site)
2. Netlify Functions ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ deploy
3. CORS ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
4. ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï

üîß ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API URL ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î API URL ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ deploy ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏ô Netlify`;
                } else {
                    errorMessage +=
`Error: ${error.message}

Stack Trace:
${error.stack || 'No stack trace'}`;
                }

                showResult('error', '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', errorMessage);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        function showResult(type, title, content) {
            const resultBox = document.getElementById('resultBox');
            const resultTitle = document.getElementById('resultTitle');
            const resultContent = document.getElementById('resultContent');

            resultBox.className = 'result-box show ' + type;
            resultTitle.textContent = title;
            resultContent.textContent = content;
        }

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô API URL ‡∏à‡∏≤‡∏Å localStorage
        window.addEventListener('load', () => {
            const savedApiUrl = localStorage.getItem('apiUrl');
            if (savedApiUrl) {
                document.getElementById('apiUrl').value = savedApiUrl;
            }
        });

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API URL ‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
        document.getElementById('apiUrl').addEventListener('change', (e) => {
            localStorage.setItem('apiUrl', e.target.value);
        });
    </script>
</body>
</html>
